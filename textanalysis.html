<!DOCTYPE html>
<html>
    <head>
        <title>Bubble Plot New</title>
        <script src="https://d3js.org/d3.v4.min.js"></script>
    </head>
    <body>
        <script>
            d3.select("body").append("p").text("Bubble plot");

            // Load data from character_metrics.json
            d3.json("character_metrics.json", function(error, data) {
                if (error) {
                    console.error("Error loading data:", error);
                    return;
                }

                // Transform data
                const transformedData = Object.entries(data).map(([character, metrics]) => ({
                    wordsPerSentence: metrics["Average Sentence Length"],
                    syllablesPerWord: metrics["Syllables per Word"],
                    sentenceLength: metrics["Average Word Length"], // Bubble size
                    character: character
                }));

                // Set dimensions
                const width = 800, height = 600, margin = 50;

                // Create SVG
                const svg = d3.select("body").append("svg")
                    .attr("width", width)
                    .attr("height", height);

                // Define scales
                const xScale = d3.scaleLinear()
                    .domain([0, d3.max(transformedData, d => d.wordsPerSentence) + 5])
                    .range([margin, width - margin]);

                const yScale = d3.scaleLinear()
                    .domain([0, d3.max(transformedData, d => d.syllablesPerWord) + 0.5])
                    .range([height - margin, margin]);

                const rScale = d3.scaleSqrt()
                    .domain([0, d3.max(transformedData, d => d.sentenceLength)])
                    .range([5, 40]);

                // Add axes
                svg.append("g")
                    .attr("transform", `translate(0, ${height - margin})`)
                    .call(d3.axisBottom(xScale));

                svg.append("g")
                    .attr("transform", `translate(${margin}, 0)`)
                    .call(d3.axisLeft(yScale));

                // Add bubbles
                svg.selectAll("circle")
                    .data(transformedData)
                    .enter()
                    .append("circle")
                    .attr("cx", d => xScale(d.wordsPerSentence))
                    .attr("cy", d => yScale(d.syllablesPerWord))
                    .attr("r", d => rScale(d.sentenceLength))
                    .attr("fill", "steelblue")
                    .attr("opacity", 0.7);

                // Add character labels to bubbles
                svg.selectAll("text.label")
                    .data(transformedData)
                    .enter()
                    .append("text")
                    .attr("x", d => xScale(d.wordsPerSentence))
                    .attr("y", d => yScale(d.syllablesPerWord))
                    .attr("text-anchor", "middle")
                    .attr("dy", ".35em")
                    .style("font-size", "10px")
                    .text(d => d.character);

                // Add axis labels
                svg.append("text")
                    .attr("x", width / 2)
                    .attr("y", height - 10)
                    .attr("text-anchor", "middle")
                    .text("Number of Words per Sentence");

                svg.append("text")
                    .attr("x", -height / 2)
                    .attr("y", 20)
                    .attr("text-anchor", "middle")
                    .attr("transform", "rotate(-90)")
                    .text("Number of Syllables per Word");
            })
        </script>
    </body>
</html>
